---
alwaysApply: true
---

Project: CliMobile (RNS). Use EXACT terminology: Base App, Plugin/Capability, Modulator, Patch Operation, Runtime Contribution, System Zone (packages/@rns/** + .rns/**), User Zone (src/**), slots/conflicts, manifest (.rns/rn-init.json).

Canonical docs set (source of truth):
- docs/README.md (docs contract map)
- docs/cli-interface-and-types.md (canonical contracts & naming)
- docs/plugins-permissions.md (permissions dataset + mapping)
- docs/WORKFLOW.md (workflow + verification)
- docs/AGENT.md (agent rules)
- docs/TODO.md (single source of truth for tasks)

Docs-first: if code and canonical docs diverge → treat as a bug and fix in the canonical place. Never duplicate schemas/types across multiple docs.

Work strictly from docs/TODO.md: always start with the FIRST unchecked [ ] section.
Unit of work = ONE TODO section per change-set/commit.
No drive-by refactors. Do not touch multiple TODO sections in one change.
Do not change contracts/behavior unless the active TODO section requires it.

Ownership boundary (non-negotiable):
- User Zone (src/** in generated apps) is developer-owned: the CLI must NOT patch it.
- System Zone (packages/@rns/** + .rns/**) is CLI-managed: OK to create/modify here.
All integration/wiring must happen in System Zone only.

Runtime wiring must be AST-based (ts-morph) and symbol-based.
NO regex injection for TS/JS runtime wiring.
NO raw code-string wiring for providers/initialization; use symbol refs and idempotent injections.

Native/config changes must be Patch Operations:
- anchored/marker-based edits
- idempotent (insert-once)
Never instruct users to edit Podfile/Gradle/Manifest/Info.plist manually for shipped plugins.

Before implementing: state a short plan (3–7 bullets) + exact files to touch.
After changes: provide concise summary + verification commands that must pass.
Update docs/TODO.md checkbox ONLY when verification passes.

**Package versions (canonical reference):**
- `deprecated_docs/generated_project_reference/package.json` is the single source of truth for all package versions.
- Never overwrite or change dependency versions in that file (including `react-native-mmkv`: `^4.1.0`, `react-native-nitro-modules`: `^0.31.10`, and all others).
- When adding or installing the same packages elsewhere (e.g. init install-dependencies, generated apps), use the versions from that reference.
